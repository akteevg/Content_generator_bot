# AI Content Idea Bot

Telegram-бот для MVP-генерации контент-идей и готовых постов с помощью GigaChat. Пользователь задаёт нишу, цель и формат, получает пять идей, выбирает одну и мгновенно получает текст поста.

## Возможности

- линейный сценарий без лишних ветвлений: сбор трёх параметров → 5 идей → выбор → готовый текст;
- промпты разделены на этапы (идеи и пост), зашиты в отдельный модуль для повторного использования;
- ответы GigaChat парсятся из JSON, чтобы исключить «глюки» с форматированием;
- состояние пользователя хранится в памяти (словарь по `user_id`) — достаточно для MVP, расширение до БД описано ниже;
- готовность к расширению: модуль `gigachat.py` и промпты можно переиспользовать в веб-интерфейсе или других каналах.

## Быстрый старт

1. **Создать виртуальное окружение**
   ```bash
   python -m venv .venv
   source .venv/bin/activate  # Windows: .venv\Scripts\activate
   ```

2. **Установить зависимости**
   ```bash
   pip install -r requirements.txt
   ```

3. **Настроить переменные окружения**
   - Скопировать файл `env.example` в `.env` и заполнить значения:
     - `TELEGRAM_BOT_TOKEN` — токен бота от BotFather;
     - `GIGACHAT_CLIENT_ID`, `GIGACHAT_CLIENT_SECRET` — ключи для GigaChat (бесплатный тариф `Lite` покрывает MVP);
     - `TELEGRAM_DISABLE_SSL_VERIFY` — по умолчанию `false`. Включите `true`, если на рабочей машине возникают проблемы с сертификатами Telegram (использовать только для диагностики);
     - `GIGACHAT_VERIFY_SSL` — `false` (MVP), `true` для проверки системных сертификатов или путь до файла корневого сертификата Минцифры.

4. **Запустить бота**
   ```bash
   python main.py
   ```

Бот запускается в режиме long polling. Для деплоя на VPS достаточно поднять виртуальное окружение и настроить `systemd`-unit.

## Технологический стек

- **Python 3.14** — язык разработки
- **pyTelegramBotAPI 4.18** — библиотека для работы с Telegram Bot API
- **GigaChat API** — российский AI для генерации контента (Sber)
- **requests** — HTTP-клиент для API-запросов
- **python-dotenv** — управление переменными окружения

## Архитектура

- `main.py` — точка входа, конфигурирует логирование и запускает бота;
- `content_bot/settings.py` — загрузка конфигурации из переменных окружения;
- `content_bot/gigachat.py` — тонкий клиент GigaChat (получение токена, вызов chat completions, кеширование токена);
- `content_bot/prompts.py` — генерация промптов для идей и постов;
- `content_bot/parsing.py` — контроль формата ответа (JSON → сущности);
- `content_bot/state.py` — in-memory хранение состояния пользователя;
- `content_bot/bot_app.py` — сценарий бота и все обработчики.

## UX сценарий и команды

- `/start` — сброс и запуск сценария заново, бот последовательно собирает нишу → цель → формат.
- `/help` — показывает справку и подсказки по использованию.
- После ввода параметров пользователь жмёт кнопку «Сгенерировать идеи», получает 5 вариантов и выбирает нужный (кнопкой или номером).
- После выбора бот формирует готовый пост и предлагает начать новый набор.

## Особенности

- Жёсткие промпты: идеи возвращаются строго в JSON, посты идут в телеграм-совместимом Markdown.
- Fallback-парсер: при «болтливом» ответе GigaChat из текста извлекается первый JSON-массив — бот более устойчив при генерации.
- Настраиваемый обход SSL-проверки (`TELEGRAM_DISABLE_SSL_VERIFY`) помогает запускать MVP в средах с нестабильными сертификатами.
- Код разбит на модули — клиент GigaChat, промпты, состояние и бот можно переиспользовать в веб-интерфейсе.

## Дальнейшие улучшения

- **SQLite** для устойчивого хранения параметров и истории (пока структура заложена in-memory, перенос займёт минимум кода);
- **Веб-интерфейс**: модули `gigachat` и `prompts` уже готовы к переиспользованию в FastAPI/Flask или Tilda/n8n;
- **Больше веток UX**: сохранение последнего набора идей, редактирование отдельных параметров без перезапуска;
- **Валидация данных**: подсказки по форматам, шаблоны для популярных ниш, пресеты целей;
- **Логи и аналитика**: сохранение статистики генераций в таблицу.

## Заметки по GigaChat

- Бесплатный тариф `Lite` даёт 900 000 токенов в год — для MVP более чем достаточно.
- Токен доступа действует около часа. Клиент автоматически обновляет его перед вызовом API.
- Если нет собственного сертификата, временно используем `verify=False` (предупреждения подавлены). Для продакшена стоит загрузить сертификат `GigaChatAPI.crt`, прописать путь в `GIGACHAT_VERIFY_SSL` и включить проверку TLS.

## Telegram-бот

[@content_generator_by_ideas_bot](https://t.me/content_generator_by_ideas_bot)

---

## Автор

**Евгений Актемиров**

- GitHub: [akteevg](https://github.com/akteevg)
